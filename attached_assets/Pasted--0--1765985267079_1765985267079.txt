Фаза 0: Подготовка и настройка проекта

Цель: Настроить рабочее окружение и каркас приложения.

    Создать виртуальное окружение Python (venv или poetry).

    Инициализировать проект Pyramid. Использовать cookiecutter или создать вручную.

    Настроить setup.py/pyproject.toml с зависимостями:

        pyramid

        sqlalchemy + psycopg2-binary (или asyncpg для асинхронности)

        alembic (для миграций БД)

        zope.sqlalchemy (для интеграции сессий)

        pyramid_jinja2 (или другой шаблонизатор)

        pyramid_debugtoolbar (для разработки)

        python-dateutil (для работы с датами)

    Настроить подключение к PostgreSQL. Создать базу данных, прописать параметры в development.ini/.env файле.

    Настроить Alembic для управления миграциями. Создать первую пустую миграцию.

    Организовать структуру проекта. Пример:
    text

family_finance/
    models/          # SQLAlchemy модели
    views/           # Вьюхи Pyramid
    scripts/         # Скрипты (например, для Alembic)
    static/          # CSS, JS, изображения
    templates/       # Jinja2 шаблоны
    __init__.py
    routes.py

Фаза 1: Модели данных (SQLAlchemy)

Цель: Спроектировать и реализовать структуру базы данных.
7. [ ] Создать модель User (Пользователь).
* id, username, email, password_hash, created_at.
8. [ ] Создать модель Family (Семья). Связь "многие-ко-многим" с User.
* id, name, members (relationship).
9. [ ] Создать модель Category (Категория расходов/доходов).
* id, name (еда, транспорт, зарплата), type (expense/income), color (HEX), icon.
* family_id (ForeignKey, категория принадлежит семье). Важно: это позволит каждой семье добавлять свои категории.
* parent_id (ForeignKey на себя) для вложенности (опционально).
10. [ ] Создать модель Account (Счет). Карточный, наличные, депозит.
* id, name, balance (текущий остаток), currency, family_id.
11. [ ] Создать модель Transaction (Транзакция). Основная сущность.
* id, amount, date, description.
* type (expense/income/transfer).
* category_id (FK to Category, nullable для переводов).
* account_id (FK to Account, откуда списано/зачислено).
* family_id.
* created_by (FK to User).
12. [ ] Создать модель Budget (План). Для удобного планирования.
* id, amount (запланированная сумма), period (month, week, year).
* category_id (или null для общего бюджета).
* family_id.
13. [ ] Создать модель ScheduledTransaction (Планируемая/Повторяемая транзакция).
* id, amount, description, schedule (cron-строка или RRULE), start_date, end_date.
* category_id, account_id, family_id.
* last_processed (дата последнего создания транзакции).
14. [ ] Созвить все связи между моделями (relationship).
15. [ ] Сгенерировать и применить миграцию Alembic.
Фаза 2: Бэкенд-логика и API (Pyramid Views)

Цель: Реализовать бизнес-логику и точки входа для фронтенда.
16. [ ] Настроить аутентификацию и авторизацию.
* Вьюхи для регистрации, логина, выхода.
* Политики безопасности Pyramid (pyramid.security).
* Проверка, что пользователь имеет доступ только к данным своей семьи.
17. [ ] Реализовать CRUD для Transaction.
* Список транзакций с пагинацией и фильтрами (по дате, категории, счету, типу).
* Создание, редактирование, удаление транзакции.
* Важно: При создании/изменении транзакции автоматически пересчитывать баланс связанного счета.
18. [ ] Реализовать CRUD для Category.
* Отдельные endpoint'ы для категорий семьи.
19. [ ] Реализовать CRUD для Account.
* Список счетов с текущими балансами.
20. [ ] Реализовать CRUD для Budget.
* Установка лимита на категорию/общий на период.
21. [ ] Реализовать логику для ScheduledTransaction.
* Создание/редактирование правил.
* Фоновая задача (Cron/ Celery): Реализовать скрипт или задачу, которая раз в день проверяет правила и создает фактические транзакции (Transaction) на сегодня.
22. [ ] Реализовать аналитические endpoints (для графиков и отчетов).
* GET /api/analytics/spend_by_category?start_date=&end_date=&type=
* GET /api/analytics/cashflow?period=month (доходы/расходы по месяцам).
* GET /api/analytics/current_budget_state (сколько уже потрачено vs план).
23. [ ] Реализовать endpoint для календаря.
* GET /api/calendar/events?month=2023-10 - возвращает массив событий (транзакций и планируемых операций) для отображения в календаре.
Фаза 3: Веб-интерфейс (Jinja2, HTML, CSS, JS)

Цель: Создать пользовательский интерфейс.
24. [ ] Выбрать и подключить CSS-фреймворк (Bootstrap, Bulma, Tailwind).
25. [ ] Создать базовый шаблон (layout.jinja2) с навигацией (главная, транзакции, отчеты, календарь, планирование, настройки).
26. [ ] Страница "Дашборд" (главная).
* Сводка: общий баланс по счетам, остаток на месяц.
* График расходов по категориям за месяц (Chart.js или аналоги).
* Последние транзакции.
27. [ ] Страница "Транзакции".
* Таблица с фильтрами и сортировкой.
* Кнопка "Добавить" (модальное окно или отдельная страница).
* Возможность быстрого редактирования.
28. [ ] Страница "Планирование (Бюджет)".
* Таблица/карточки с категориями, установленным лимитом и текущим расходом (прогресс-бар).
* Форма настройки лимитов.
29. [ ] Страница "Календарь".
* Внедрить JS-календарь (FullCalendar, Vanilla Calendar).
* Отображать транзакции и запланированные события (из ScheduledTransaction) как события календаря.
* Клик по дню -> форма быстрого добавления транзакции.
30. [ ] Страница "Счета".
* Просмотр, добавление, корректировка баланса.
31. [ ] Страница "Категории".
* Управление категориями семьи: создание, редактирование (смена цвета/иконки), удаление.
32. [ ] Страница "Повторяемые платежи".
* Список и управление ScheduledTransaction.
33. [ ] Страница "Отчеты".
* Выбор периода, типа отчета.
* Визуализация данных (графики, диаграммы).
34. [ ] Реализовать динамические обновления на ключевых страницах с использованием HTMX или небольшого количества Vanilla JS/Fetch API для избежания сложности SPA.
Фаза 4: Дополнительные функции и полировка

    Импорт транзакций из CSV/Excel (выписки банков).

    Экспорт данных в CSV/PDF.

    Система уведомлений (например, о превышении бюджета) на email или в интерфейсе.

    Мультивалютность (хранение курсов, пересчет в базовую валюту).

    API для мобильного приложения (расширить существующие endpoints, добавить JWT-аутентификацию).

    Написание тестов: unit-тесты для моделей и сервисов, функциональные тесты для вьюх.

    Оптимизация запросов к БД (жадная загрузка, индексы).

    Документация: README.md, комментарии в коде.

Фаза 5: Развертывание

    Подготовка к продакшену: настройка production.ini, отключение debug toolbar.

    Выбор хостинга: VPS (например, DigitalOcean, Timeweb), или PaaS (Heroku, PythonAnywhere).

    Настройка веб-сервера: Gunicorn/uWSGI + Nginx.

    Настройка SSL-сертификата (Let's Encrypt).

    Настройка периодических задач (для ScheduledTransaction) через системный cron или Celery на продакшене.

    Резервное копирование БД.

Ключевые технологии в стэке:

    Backend: Python 3, Pyramid (легковесный, гибкий фреймворк)

    База данных: PostgreSQL (надежная, с расширенными типами данных)

    ORM: SQLAlchemy (промышленный стандарт для Python)

    Миграции: Alembic

    Фронтенд: Jinja2 (шаблонизация), HTMX/Vanilla JS (для интерактивности), Bootstrap/Tailwind (стили), Chart.js (графики), FullCalendar (календарь)